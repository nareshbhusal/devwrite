!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="/",t(t.s=14)}([function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(5),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.findOne({where:o({},r)});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(5),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.update(o({},t),{where:{id:r}});case 2:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r){e.exports=require("express")},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(7),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.findOne({where:o({},r)});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=a},function(e,r){e.exports=require("sequelize")},function(e,r,t){var n=t(4),o=t(8).define("user",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:n.STRING},about:{type:n.STRING},email:{type:n.STRING},password:{type:n.STRING},website:{type:n.STRING},photo:{type:n.STRING},posts:{type:n.ARRAY(n.INTEGER)},createdAt:{type:n.STRING},followers:{type:n.ARRAY(n.INTEGER)},following:{type:n.ARRAY(n.INTEGER)},likedPosts:{type:n.ARRAY(n.INTEGER)},commentedPosts:{type:n.JSON},savedPosts:{type:n.ARRAY(n.INTEGER)},session_ids:{type:n.STRING}});e.exports=o},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(7),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.update(o({},t),{where:o({},r)});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){var n=t(4),o=t(8).define("post",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},title:{type:n.STRING},body:{type:n.STRING},user:{type:n.INTEGER},username:{type:n.STRING},about:{type:n.STRING},tags:{type:n.ARRAY(n.STRING)},comments:{type:n.JSON},createdAt:{type:n.STRING},editedAt:{type:n.STRING},likedBy:{type:n.ARRAY(n.INTEGER)},numOfLikes:{type:n.INTEGER,defaultValue:0}});e.exports=o},function(e,r,t){var n=t(4),o=process.env,u=o.DB_NAME,s=o.HOST,i=o.DB_USER,a=o.DB_PASS;e.exports=new n(u,i,a,{host:s,dialect:"postgres",pool:{max:5,min:0,acquire:3e4,idle:1e3},define:{timestamps:!1},logging:!1})},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session){e.next=2;break}return e.abrupt("return",!1);case 2:if(!r.session.user){e.next=15;break}return t=r.session.user.id,e.next=6,o({id:t});case 6:if(!(n=e.sent)){e.next=12;break}if(!n.session_ids.split(",").some((function(e){return e===r.sessionID}))){e.next=11;break}return e.abrupt("return",!0);case 11:r.session.destroy((function(e){e&&console.log(e)}));case 12:case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){var n=t(4),o=t(8).define("tag",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},postId:{type:n.INTEGER},tagName:{type:n.STRING}});e.exports=o},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(9),u=function(e){e.header("Cache-Control","no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0")},s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var s,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={err:"This action requires authorization! Please login or signup"},i={err:"Server error: Something went wrong checking authorization"},e.prev=2,e.next=5,o(r);case 5:a=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",t.status(500).send(i));case 11:if(!a){e.next=16;break}return u(t),e.abrupt("return",n());case 16:return e.abrupt("return",t.status(403).send(s));case 17:case"end":return e.stop()}}),e,null,[[2,8]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=s},function(e,r){e.exports=function(e,r){e.session.user={},e.session.user.id=r.id}},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))}}var u=t(31),s=t(0),i=function(){var e=o(regeneratorRuntime.mark((function e(r,t,n){var o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!1,u=!1,-1!==n.indexOf(r)&&(o=!0),-1!==t.indexOf(r)&&(u=!0),e.abrupt("return",{saved:o,liked:u});case 5:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),a=function(e,r){var t=e.comments||[];return"string"==typeof t&&(t=JSON.parse(t)),t.map((function(e){var t=e.likedBy||[];return e.isLiked=-1!==t.indexOf(r),e}))},c=function(){var e=o(regeneratorRuntime.mark((function e(r,t){var n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.title?(c=!0,n=[r]):(c=!1,n=r),!t){e.next=7;break}return e.next=4,s({id:t});case 4:loggedUser=e.sent,savedPosts=loggedUser.savedPosts||[],likedPosts=loggedUser.likedPosts||[];case 7:return e.next=9,Promise.all(n.map(function(){var e=o(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.likedBy=r.likedBy||[],r.comments=a(r,t),r.dataValues.readingTime=u(r.body).text,r.dataValues.date=new Date(parseInt(r.createdAt)).toDateString().split(" ").splice(1).join(" "),!t){e.next=10;break}return e.next=7,i(r.id,likedPosts,savedPosts);case 7:n=e.sent,r.dataValues.saved=n.saved,r.dataValues.liked=n.liked;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 9:if(n=e.sent,!c){e.next=12;break}return e.abrupt("return",n[0]);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();e.exports=c},function(e,r,t){t(15),e.exports=t(16)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,t){var n=t(17),o=process.env.PORT||5e3;n.listen(o,(function(){console.log("listening at port ".concat(o))}))},function(e,r,t){var n=t(2),o=t(18),u=t(19),s=t(20)(o),i=t(21),a=t(8),c=n(),p=t(22),f=t(23),l=u.createClient();l.on("connect",(function(){console.log("Redis connected")})),c.use(n.json()),c.use(n.urlencoded({extended:!0})),c.use(i({credentials:!0,origin:!0})),c.use(o({genid:function(e){return p()},secret:process.env.SESSION_SECRET,saveUninitialized:!0,resave:!0,store:new s({client:l}),cookie:{secure:!1,maxAge:432e5}})),a.authenticate().then((function(){return console.log("database connected")})).catch((function(e){return console.log("SOMETHING WRONG WITH DATABASE",e)})),c.get("",(function(e,r){return r.status(201).send(e.session)})),c.use(f),e.exports=c},function(e,r){e.exports=require("express-session")},function(e,r){e.exports=require("redis")},function(e,r){e.exports=require("connect-redis")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("uuid")},function(e,r,t){var n=t(2).Router(),o=t(24),u=t(29),s=t(48),i=t(56);n.use("/",o),n.use("/users",s),n.use("/posts",u),n.use("/tags",i),e.exports=n},function(e,r,t){var n=t(2).Router(),o=t(25),u=t(27);n.post("/login",o),n.post("/logout",u),e.exports=n},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(26),a=t(12),c=t(0),p=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=o({},r.body)).email&&n.password){e.next=4;break}return u={err:"Please fill in all fields"},e.abrupt("return",t.status(401).send(u));case 4:return e.prev=4,e.next=7,c(n);case 7:if(!(s=e.sent)){e.next=15;break}return e.next=11,i(s,r.sessionID);case 11:return a(r,s),e.abrupt("return",t.status(200).send({msg:"Logged in!"}));case 15:return e.abrupt("return",t.status(401).send({err:"Wrong password or username!"}));case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong logging in!"}));case 22:case"end":return e.stop()}}),e,null,[[4,18]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=p},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(1),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=r.session_ids)&&((n=n.split(",")).length>4&&n.pop(),n.unshift(t),n=n.toString()),e.prev=2,e.next=5,o(r.id,{session_ids:n});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=t(28),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session){e.next=2;break}return e.abrupt("return",t.status(400).send({err:"Already logged out!"}));case 2:if(!r.session.user){e.next=17;break}return e.prev=3,n=r.session.user.id,e.next=7,o(n);case 7:if(!(s=e.sent)){e.next=12;break}return e.next=11,u(r,s);case 11:return e.abrupt("return",t.status(200).send({msg:"User logged out!"}));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),t.status(500).send({err:"something went wrong while trying to log out!"});case 17:t.status(409).send({err:"Already logged out!"});case 18:case"end":return e.stop()}}),e,null,[[3,14]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(1),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=t.session_ids).split(",").filter((function(e){return e!==r.sessionID})).toString(),e.next=4,o(t.id,{session_ids:n});case 4:r.session.destroy((function(e){if(e)return console.log(e)}));case 5:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){var n=t(2).Router(),o=t(30),u=t(32),s=t(33),i=t(36),a=t(37),c=t(38),p=t(39),f=t(41),l=t(11);n.get("/:sortorder/",o),n.get("/:id",u),n.post("/",l,s),n.put("/:id",l,i),n.post("/:id/like",l,a),n.post("/:id/save",l,c),n.delete("/:id",l,p),n.use("/:postid/comment",f),e.exports=n},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var u=t(7),s=t(10),i=t(4),a=t(9),c=t(13),p=function(e){var r=e.tag,t=void 0===r?"":r,n=e.page,u=e.days,a=e.sortorder,c=e.search,p=void 0===c?"":c,f=10*(n-1),l={where:{title:o({},i.Op.iLike,"%".concat(p,"%"))},limit:10,offset:f};if("top"===a){var d=new Date;d.setHours(d.getHours()-24*parseInt(u));var v=new Date;d=d.getTime().toString(),v=v.getTime().toString(),l.order=[["numOfLikes","DESC"]],"all"!==u&&(l.where.createdAt=o({},i.Op.between,[d,v]))}else l.order=[["createdAt","DESC"]];return t&&(l.include=[{model:s,having:["postId = id"],where:{tagName:o({},i.Op.iLike,"%".concat(t,"%"))},required:!0}]),l},f=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var o,i,f,l,d,v,m,g,h,y,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=r.params.sortorder,i=r.query,f=i.t,l=i.page,d=i.tag,v=i.search,m=f,"top"===o||"new"===o){e.next=6;break}return e.abrupt("return",n());case 6:return g=p({tag:d,page:l,days:m,sortorder:o,search:v}),u.belongsTo(s,{targetKey:"postId",foreignKey:"id"}),e.next=10,u.findAll(g);case 10:return h=e.sent,e.next=13,a(r);case 13:return e.sent&&(y=parseInt(r.session.user.id)),e.next=17,c(h,y);case 17:return b=e.sent,e.abrupt("return",t.status(200).send(b));case 21:return e.prev=21,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong fetching posts"}));case 25:case"end":return e.stop()}}),e,null,[[0,21]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=f},function(e,r){e.exports=require("reading-time")},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(3),u=t(13),s=t(9),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.id,e.next=4,o({id:n});case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return",t.status(404).send({err:"404: No such post found"}));case 7:return e.next=9,s(r);case 9:return e.sent&&(a=parseInt(r.session.user.id)),e.next=13,u(i,a);case 13:return c=e.sent,e.abrupt("return",t.status(200).send(c));case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),t.status(500).send({err:"Something went wrong!"});case 21:case"end":return e.stop()}}),e,null,[[0,17]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(34),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r.body||{}).title&&n.body){e.next=3;break}return e.abrupt("return",t.status(422).send({err:"Please fill in all fields!"}));case 3:return e.prev=3,n=o({},r.body),u=r.session.user.id,e.next=8,i(n,u);case 8:return e.abrupt("return",t.status(201).send({msg:"Post created!"}));case 11:return e.prev=11,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong!"}));case 15:case"end":return e.stop()}}),e,null,[[3,11]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(7),u=t(0),s=t(1),i=t(35),a=function(e){var r=e.tags||"";return r?r.split(" "):[]},c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,c,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.user=t,r.createdAt=(new Date).getTime(),r.tags=a(r),e.prev=3,e.next=6,u({id:t});case 6:return n=e.sent,c=n.name,r.username=c,e.next=11,o.create(r);case 11:return p=e.sent,e.next=14,i(r.tags,p.id);case 14:return(f=n.posts||[]).push(parseInt(p.id)),e.next=18,s(t,{posts:f});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(3),e.t0;case 23:case"end":return e.stop()}}),e,null,[[3,20]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(10),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.map((function(e){return{tagName:e,postId:t}})),e.next=3,o.bulkCreate(n);case 3:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(6),a=function(e){var r=e.tags||"";return r?r.split(" "):[]},c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.id,u=r.session.user.id,(s=o({},r.body)).editedAt=(new Date).getTime(),s.tags=a(s),c={user:u,id:n},e.next=9,i(c,s);case 9:if(e.sent){e.next=12;break}return e.abrupt("return",t.status(409).send({err:"Is this your post? This is awkward..hmmm..."}));case 12:return e.abrupt("return",t.status(201).send({msg:"Updated the post"}));case 15:return e.prev=15,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Sever error: Something went wrong editing post :("}));case 19:case"end":return e.stop()}}),e,null,[[0,15]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=t(3),s=t(6),i=t(1),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,a,c,p,f,l,d,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(r.params.id),a=parseInt(r.session.user.id),e.next=5,o({id:a});case 5:return c=e.sent,p=c.likedPosts||[],e.next=9,u({id:n});case 9:return f=e.sent,(l=f.likedBy||[]).some((function(e){return e===a}))?(d=!1,l.splice(l.indexOf(a),1),p.splice(p.indexOf(n),1)):(d=!0,l.push(parseInt(a)),p.push(parseInt(n))),v=l.length,e.next=16,s({id:n},{likedBy:l,numOfLikes:v});case 16:return e.next=18,i(a,{likedPosts:p});case 18:return e.abrupt("return",t.status(201).send({msg:"".concat(d?"Liked":"Unliked"," post")}));case 21:return e.prev=21,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send("Something went wrong!"));case 25:case"end":return e.stop()}}),e,null,[[0,21]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(5),u=t(1),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.session.user.id,s=parseInt(r.params.id),e.next=5,o.findOne({where:{id:n}});case 5:return i=e.sent,a=i.savedPosts||[],c=!1,-1===a.indexOf(s)?(c=!0,a.push(s)):a.splice(a.indexOf(s),1),e.next=11,u(n,{savedPosts:a});case 11:return e.abrupt("return",t.status(200).send({msg:"".concat(c?"Saved":"Unsaved"," post!")}));case 14:return e.prev=14,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error while saving post :("}));case 18:case"end":return e.stop()}}),e,null,[[0,14]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(40),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(r.params.id),u=parseInt(r.session.user.id),e.next=5,o({user:u,id:n});case 5:return e.abrupt("return",t.status(200).send({msg:"Deleted post!"}));case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(400).send({err:"Something went wrong deleting post"}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(7),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.destroy({where:o({},r)});case 2:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){var n=t(2).Router({mergeParams:!0}),o=t(11),u=t(42),s=t(43),i=t(45),a=t(46),c=t(47);n.get("/:commentid",u),n.post("/",o,s),n.put("/:commentid",o,i),n.delete("/:commentid",o,a),n.post("/:commentid/like",o,c),e.exports=n},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(3),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(r.params.postid),u=parseInt(r.params.commentid),e.next=5,o({id:n});case 5:if(s=e.sent){e.next=8;break}return e.abrupt("return",t.status(404).send({err:"Post not found"}));case 8:if("string"==typeof(i=s.comments||[])&&(i=JSON.parse(i)),!(a=i.find((function(e){return e.id===u})))){e.next=15;break}return e.abrupt("return",t.status(200).send(a));case 15:return e.abrupt("return",t.status(404).send({err:"Comment not found!"}));case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error"}));case 22:case"end":return e.stop()}}),e,null,[[0,18]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(44),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body.body){e.next=3;break}return e.abrupt("return",t.status(422).send({err:"Please provide a comment body!"}));case 3:return e.prev=3,n=r.body.body,u=r.session.user.id,s=r.params.postid,e.next=9,o(n,s,u);case 9:return e.abrupt("return",t.status(201).send({msg:"Comment posted"}));case 12:return e.prev=12,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong while commenting"}));case 16:case"end":return e.stop()}}),e,null,[[3,12]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var u=t(0),s=t(3),i=t(1),a=t(6),c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,o){var c,p,f,l,d,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({id:o});case 2:return c=e.sent,e.next=5,s({id:t});case 5:return p=e.sent,"string"==typeof(f=c.commentedPosts||[])&&(f=JSON.parse(f)),f=f||[],l=Math.max.apply(Math,n(f.map((function(e){return e.id}))))+1,d={body:r,createdAt:(new Date).getTime(),id:l,username:c.name,postTitle:p.title,postId:t,userId:o},console.log(d),f.push(d),f=JSON.stringify(f),e.next=16,i(o,{commentedPosts:f});case 16:return console.log(f),"string"==typeof(v=p.comments||[])&&(v=JSON.parse(v)),(v=v||[]).push(d),v=JSON.stringify(v),e.next=24,a({id:t},{comments:v});case 24:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function i(e){o(s,n,u,i,a,"next",e)}function a(e){o(s,n,u,i,a,"throw",e)}i(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(3),a=t(6),c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s,c,p,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params,u=n.postid,s=n.commentid,e.next=4,i({id:u});case 4:if(c=e.sent){e.next=7;break}return e.abrupt("return",t.status(400).send({err:"Post doesn't exist"}));case 7:if(p={body:r.body.body,editedAt:Date.now().toString()},"string"==typeof(f=c.comments||[])&&(f=JSON.parse(f)),-1!==(l=(f=f||[]).findIndex((function(e){return e.id==s})))){e.next=14;break}return e.abrupt("return",t.status(403).send({err:"Unauthorized request!"}));case 14:return f[l]=o({},f[l],{},p),f=JSON.stringify(f),e.next=18,a({id:u},{comments:f});case 18:return e.abrupt("return",t.status(201).send({msg:"Edited comment"}));case 21:return e.prev=21,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error!"}));case 25:case"end":return e.stop()}}),e,null,[[0,21]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(3),u=t(6),s=t(0),i=t(1),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,a,c,p,f,l,d,v,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params,a=n.postid,c=n.commentid,p=r.session.user.id,e.next=5,o({id:a});case 5:if(f=e.sent,"string"==typeof(l=f.comments)&&(l=JSON.parse(l)),-1!==(d=(l=l||[]).findIndex((function(e){return e.id==c&&p==e.userId})))){e.next=12;break}return e.abrupt("return",t.status(400).send({err:"Ok but... Something doesn't feel right :/"}));case 12:return l.splice(d,1),l=JSON.stringify(l),e.next=16,u({id:a},{comments:l});case 16:return e.next=18,s({id:p});case 18:return v=e.sent,"string"==typeof(m=v.commentedPosts)&&(m=JSON.parse(m)),(g=(m=m||[]).findIndex((function(e){return e.id==c&&e.postId==a})))&&m.splice(g,1),m=JSON.stringify(m),e.next=27,i(p,{commentedPosts:m});case 27:return e.abrupt("return",t.status(200).send({msg:"Deleted comment successfully!"}));case 30:return e.prev=30,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong"}));case 34:case"end":return e.stop()}}),e,null,[[0,30]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(3),a=t(6),c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s,c,p,f,l,d,v,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params,u=n.commentid,s=n.postid,c=r.session.user.id,u=parseInt(u),s=parseInt(s),c=parseInt(c),e.next=8,i({id:s});case 8:if(p=e.sent,"string"==typeof(f=p.comments||[])&&(f=JSON.parse(f)),-1!==(l=(f=f||[]).findIndex((function(e){return e.id===u})))){e.next=15;break}return e.abrupt("return",t.status(400).send({err:"Comment not available"}));case 15:return d=f[l],v=d.likedBy||[],m=!1,-1===v.indexOf(c)?(v.push(c),m=!0):v.splice(v.indexOf(c),1),g=o({},d,{likedBy:v}),f[l]=g,f=JSON.stringify(f),e.next=24,a({id:s},{comments:f});case 24:return e.abrupt("return",t.status(200).send({msg:"".concat(m?"Liked":"Unliked"," comment!")}));case 27:return e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error!"}));case 31:case"end":return e.stop()}}),e,null,[[0,27]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){var n=t(2).Router(),o=t(49),u=t(50),s=t(51),i=t(52),a=t(53),c=t(54),p=t(55),f=t(11);n.get("/",o),n.post("/",u),n.get("/me",f,s),n.get("/:id",i),n.put("/:id",f,c),n.delete("/:id/delete",f,p),n.post("/:id/follow",f,a),e.exports=n},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(5),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.findAll();case 3:return n=e.sent,e.abrupt("return",t.status(200).send(n));case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error fetching users"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(5),a=t(12),c=t(0),p=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(n=o({},r.body)||{}).name&&n.password&&n.email){e.next=4;break}return e.abrupt("return",t.status(422).send({err:"Please fill all fields"}));case 4:return e.next=6,c({email:n.email});case 6:if(!e.sent){e.next=9;break}return e.abrupt("return",t.status(409).send({err:"Email is already in use!"}));case 9:return n.session_ids=r.sessionID.toString(),n.createdAt=(new Date).getTime(),e.prev=11,e.next=14,i.create(n);case 14:u=e.sent,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(11),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong creating user :("}));case 21:return a(r,u),e.abrupt("return",t.status(201).send({msg:"User registered successfully!"}));case 25:e.prev=25,e.t1=e.catch(0),console.log(e.t1);case 28:case"end":return e.stop()}}),e,null,[[0,25],[11,17]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=p},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.session.user.id,e.next=4,o({id:n});case 4:return u=e.sent,e.abrupt("return",t.status(200).send(u));case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong fetching your profile :("}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=t(9),s=function(e){return e.createdAt=new Date(parseInt(e.createdAt)).toDateString().split(" ").splice(1).join(" "),e.followers=e.followers||[],e.following=e.following||[],e.posts=e.posts||[],e.commentedPosts=e.commentedPosts||[],"string"==typeof e.commentedPosts&&(e.commentedPosts=JSON.parse(e.commentedPosts)),e},i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.id,e.next=4,o({id:n});case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return",t.status(404).send({err:"404. This user is either deleted or never existed!"}));case 7:return i=s(i),e.next=10,u(r);case 10:return e.sent&&(a=r.session.user.id,i.dataValues.followed=-1!==i.followers.indexOf(a)),e.abrupt("return",t.status(201).send(i));case 15:return e.prev=15,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error"}));case 19:case"end":return e.stop()}}),e,null,[[0,15]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(0),u=t(1),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s,i,a,c,p,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=parseInt(r.session.user.id),s=parseInt(r.params.id),e.next=5,o({id:s});case 5:return i=e.sent,a=i.followers||[],-1===(c=a.indexOf(n))?(p=!0,a.push(n)):(p=!1,a.splice(c,1)),e.next=11,u(s,{followers:a});case 11:return e.next=13,o({id:s});case 13:return f=e.sent,l=f.following||[],p?l.push(s):l.splice(s,1),e.next=18,u(n,{following:l});case 18:if(!p){e.next=22;break}return e.abrupt("return",t.status(200).send({msg:"Following"}));case 22:return e.abrupt("return",t.status(200).send({msg:"Unfollowed"}));case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong following this user"}));case 29:case"end":return e.stop()}}),e,null,[[0,25]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var i=t(1),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session.user.id==r.params.id){e.next=3;break}return n={err:"Can't perform this action as you are not logged in as this user!"},e.abrupt("return",t.status(403).send(n));case 3:return u=o({},r.body),e.prev=4,s=r.session.user.id,e.next=8,i(s,o({},u));case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong updating the user"}));case 14:return e.abrupt("return",t.status(200).send({msg:"user with id "+r.params.id+" edited!"}));case 15:case"end":return e.stop()}}),e,null,[[4,10]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function i(e){s(u,n,o,i,a,"next",e)}function a(e){s(u,n,o,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(5),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session.user.id==r.params.id){e.next=3;break}return n={err:"Can't perform this action as you are not logged in as this user!"},e.abrupt("return",t.status(403).send(n));case 3:return e.prev=3,e.next=6,o.destroy({where:{id:r.session.user.id}});case 6:return e.abrupt("return",t.status(200).send({msg:"Deleted successfully!"}));case 9:return e.prev=9,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Couldn't delete user"}));case 13:case"end":return e.stop()}}),e,null,[[3,9]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){var n=t(2).Router(),o=t(57);n.get("/",o),e.exports=n},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(58),u=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,o(25);case 4:return n=e.sent,e.abrupt("return",t.status(200).send(n));case 8:return e.prev=8,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"server error fetching tag cloud"}));case 12:case"end":return e.stop()}}),e,null,[[1,8]])})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=u},function(e,r,t){function n(e,r,t,n,o,u,s){try{var i=e[u](s),a=i.value}catch(e){return void t(e)}i.done?r(a):Promise.resolve(a).then(n,o)}var o=t(10),u=t(4),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(){var r,t,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>0&&void 0!==n[0]?n[0]:25,e.next=3,o.findAll({attributes:["tagName",[u.fn("count",u.col("tagName")),"frequency"]],group:["tagName"],order:[[u.fn("count",u.col("tagName")),"DESC"]]});case 3:return t=e.sent,e.abrupt("return",t.slice(0,r));case 5:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(o,u){var s=e.apply(r,t);function i(e){n(s,o,u,i,a,"next",e)}function a(e){n(s,o,u,i,a,"throw",e)}i(void 0)}))});return function(){return r.apply(this,arguments)}}();e.exports=s}]);